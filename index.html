<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Couple Diary ‚Äî Flip Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --accent:#f28b82;
    --bg-soft:#fffaf7;
    --muted:#5c4d4d;
    --panel:#ffffff;
  }
  body{
    margin:0;
    background:var(--bg-soft);
    color:var(--muted);
    font-family:"Noto Sans KR",sans-serif;
    overflow:hidden;
  }
  #login-section{
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  .panel{
    background:var(--panel);
    border-radius:16px;
    padding:1rem;
    box-shadow:0 8px 20px rgba(0,0,0,0.05);
    border:1px solid rgba(0,0,0,0.04);
  }
  button.primary{
    background:var(--accent);
    color:#fff;
    border:none;
    border-radius:10px;
    padding:0.5rem 1rem;
    font-weight:600;
    cursor:pointer;
  }
  .flip-container {
    perspective: 2000px;
    height:100vh;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .page {
    width:90%;
    max-width:1100px;
    height:90%;
    position:absolute;
    transform-origin:left center;
    background:var(--panel);
    border-radius:18px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
    padding:2rem;
    backface-visibility:hidden;
    transition:transform 1s ease, opacity 1s ease;
    opacity:0;
  }
  .page.active {
    transform:rotateY(0deg);
    opacity:1;
    z-index:2;
  }
  .page.prev {
    transform:rotateY(-180deg);
    opacity:0;
  }
  .page.next {
    transform:rotateY(180deg);
    opacity:0;
  }
  .nav-btn{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:var(--accent);
    color:white;
    padding:0.5rem 0.8rem;
    border-radius:50%;
    cursor:pointer;
    box-shadow:0 3px 10px rgba(0,0,0,0.2);
    user-select:none;
  }
  #prevPage{left:1rem;}
  #nextPage{right:1rem;}
</style>
</head>
<body>
  <!-- Î°úÍ∑∏Ïù∏ -->
  <section id="login-section">
    <div class="panel text-center max-w-sm w-full">
      <div id="heart" class="text-4xl mb-2">ü§ç</div>
      <h2 class="mb-2 font-semibold text-gray-700">Login</h2>
      <input id="login-id" placeholder="ID ÏûÖÎ†• (SM0710 / CY0710)" type="text" class="border rounded-lg p-2 w-full mb-3"/>
      <button id="login-btn" class="primary w-full">Login</button>
    </div>
  </section>

  <!-- Îã§Ïù¥Ïñ¥Î¶¨ -->
  <div id="diary" class="hidden flip-container">
    <div class="page active" id="page1">
      <h2 class="text-xl font-semibold text-[var(--accent)] mb-2">üñ§ Today Log</h2>
      <textarea id="today-text" class="w-full h-40 border rounded p-2"></textarea>
      <button id="today-save" class="primary mt-2">Ï†ÄÏû•</button>
      <div id="today-list" class="mt-3 space-y-2 overflow-y-auto max-h-60"></div>
    </div>

    <div class="page next" id="page2">
      <h2 class="text-xl font-semibold text-[var(--accent)] mb-3">üì∏ Couple Photo</h2>
      <div class="text-center">
        <img id="photo-img" src="https://via.placeholder.com/400x300?text=Ïö∞Î¶¨Ïùò+ÏÇ¨ÏßÑ" class="mx-auto rounded-xl max-h-72 object-cover"/>
        <input type="file" id="photo-upload" accept="image/*" class="hidden"/>
        <div id="upload-trigger" class="text-[var(--accent)] mt-2 cursor-pointer">ÏÇ¨ÏßÑ Î≥ÄÍ≤ΩÌïòÍ∏∞</div>
      </div>
    </div>

    <div class="page next" id="page3">
      <h2 class="text-xl font-semibold text-[var(--accent)] mb-2">üí¨ Chat Log</h2>
      <div id="chat-box" class="overflow-y-auto max-h-60 flex flex-col items-end gap-2"></div>
      <input id="chat-input" type="text" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" class="w-full border rounded p-2 mt-2"/>
      <button id="send-btn" class="primary mt-2">Î≥¥ÎÇ¥Í∏∞</button>
    </div>

    <div class="page next" id="page4">
      <h2 class="text-xl font-semibold text-[var(--accent)] mb-3">üéµ Playlist</h2>
      <div class="flex gap-2">
        <input id="music-link" placeholder="YouTube ÎßÅÌÅ¨ ÏûÖÎ†•" class="flex-1 border rounded p-2"/>
        <button id="music-add" class="primary">Ï∂îÍ∞Ä</button>
      </div>
      <div id="music-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mt-3"></div>
    </div>

    <div id="prevPage" class="nav-btn">„Äà</div>
    <div id="nextPage" class="nav-btn">„Äâ</div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, orderBy, query, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } 
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey:"AIzaSyBw9CXG7BMyCQ3qMWFaXPfi_gS_HIiXIOA",
    authDomain:"couple-diary-42d49.firebaseapp.com",
    projectId:"couple-diary-42d49",
    storageBucket:"couple-diary-42d49.firebasestorage.app",
    messagingSenderId:"162533479109",
    appId:"1:162533479109:web:a67f8d213bddafc66fd6ac"
  };
  const app=initializeApp(firebaseConfig);
  const db=getFirestore(app);
  const storage=getStorage(app);

  const loginBtn=document.getElementById("login-btn");
  const loginInput=document.getElementById("login-id");
  const loginSection=document.getElementById("login-section");
  const diary=document.getElementById("diary");
  const heart=document.getElementById("heart");
  const pages=document.querySelectorAll(".page");
  const prevBtn=document.getElementById("prevPage");
  const nextBtn=document.getElementById("nextPage");
  let current=0;
  let user=null;

  // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
  function showPage(index){
    pages.forEach((p,i)=>{
      p.classList.remove("active","next","prev");
      if(i===index)p.classList.add("active");
      else if(i<index)p.classList.add("prev");
      else p.classList.add("next");
    });
  }
  prevBtn.onclick=()=>{if(current>0){current--;showPage(current);}};
  nextBtn.onclick=()=>{if(current<pages.length-1){current++;showPage(current);}};

  // Î°úÍ∑∏Ïù∏
  loginBtn.addEventListener("click",()=>{
    const id=loginInput.value.trim();
    if(id==="SM0710") user={name:"ÍπÄÏÜîÏùå"};
    else if(id==="CY0710") user={name:"ÏµúÏöîÏõê"};
    else return alert("Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ ID");
    heart.textContent="ü§ç";
    loginSection.classList.add("hidden");
    diary.classList.remove("hidden");
    loadData();
  });

  // Firebase Ïó∞Îèô (Í∞ÑÎûµÌûà)
  const todayText=document.getElementById("today-text");
  const todaySave=document.getElementById("today-save");
  const todayList=document.getElementById("today-list");
  const chatInput=document.getElementById("chat-input");
  const sendBtn=document.getElementById("send-btn");
  const chatBox=document.getElementById("chat-box");
  const musicAdd=document.getElementById("music-add");
  const musicInput=document.getElementById("music-link");
  const musicList=document.getElementById("music-list");
  const photoUpload=document.getElementById("photo-upload");
  const photoImg=document.getElementById("photo-img");
  const uploadTrigger=document.getElementById("upload-trigger");

  todaySave.onclick=async()=>{
    if(!user)return;
    await addDoc(collection(db,"todayLogs"),{text:todayText.value,by:user.name,timestamp:serverTimestamp()});
    todayText.value="";
  };
  onSnapshot(query(collection(db,"todayLogs"),orderBy("timestamp","desc")),snap=>{
    todayList.innerHTML="";
    snap.forEach(d=>{
      const data=d.data();
      const div=document.createElement("div");
      div.className="p-2 bg-[#fff5f2] rounded-lg text-sm";
      div.innerHTML=`${data.text}<div class='text-xs text-gray-400 mt-1'>${data.by}</div>`;
      todayList.appendChild(div);
    });
  });
  sendBtn.onclick=async()=>{
    if(!user)return;
    await addDoc(collection(db,"chat"),{msg:chatInput.value,by:user.name,timestamp:serverTimestamp()});
    chatInput.value="";
  };
  onSnapshot(query(collection(db,"chat"),orderBy("timestamp","desc")),snap=>{
    chatBox.innerHTML="";
    snap.forEach(d=>{
      const data=d.data();
      const div=document.createElement("div");
      div.className="bg-[#fff5f2] rounded-lg p-2 text-right text-sm";
      div.innerHTML=`${data.msg}<div class='text-xs text-gray-400 mt-1'>${data.by}</div>`;
      chatBox.append(div);
    });
  });
  musicAdd.onclick=async()=>{
    if(!user)return;
    await addDoc(collection(db,"playlist"),{url:musicInput.value,by:user.name,timestamp:serverTimestamp()});
    musicInput.value="";
  };
  onSnapshot(query(collection(db,"playlist"),orderBy("timestamp","desc")),snap=>{
    musicList.innerHTML="";
    snap.forEach(d=>{
      const data=d.data();
      const id=data.url.match(/v=([A-Za-z0-9_-]+)/);
      if(id){
        const div=document.createElement("div");
        div.innerHTML=`
        <iframe class='w-full h-32 rounded-lg' src='https://www.youtube.com/embed/${id[1]}'></iframe>
        <div class='text-xs text-center text-gray-500'>${data.by}</div>`;
        musicList.append(div);
      }
    });
  });
  uploadTrigger.onclick=()=>photoUpload.click();
  photoUpload.onchange=async(e)=>{
    const file=e.target.files[0];
    if(!file)return;
    const storageRef=ref(storage,`photos/${file.name}`);
    await uploadBytes(storageRef,file);
    const url=await getDownloadURL(storageRef);
    photoImg.src=url;
  };

  function loadData(){
    showPage(0);
  }
</script>
</body>
</html>
