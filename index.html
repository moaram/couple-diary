<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Couple Diary â€” Login Fix</title>
<style>
  :root{
    --coral:#ff8b7a;
    --navy:#2d3748;
    --soft:#faf9f8;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto; background:#fff; color:var(--navy);}

  /* ì „ì²´ ë ˆì´ì•„ì›ƒ: ë¡œê·¸ì¸ / ëŒ€ì‹œë³´ë“œëŠ” ì ˆëŒ€ ìœ„ì¹˜ë¡œ ê²¹ì¹˜ê²Œ */
  .screen {
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    -webkit-tap-highlight-color:transparent;
    background:linear-gradient(180deg,#fff,#fcfbfa);
  }

  /* ë¡œê·¸ì¸ ë°•ìŠ¤ */
  .login-card {
    width: min(420px, 92%);
    background: #fff;
    border-radius:14px;
    padding:28px;
    box-shadow:0 12px 40px rgba(39,49,64,0.06);
    text-align:center;
    transform-origin:center;
    animation:cardIn 0.45s ease;
  }
  @keyframes cardIn {
    from { opacity: 0; transform: translateY(14px) scale(.995); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .brand {
    font-size:20px; font-weight:700; color:var(--navy); margin-bottom:10px;
  }
  .heart {
    font-size:34px; display:block; margin: 6px auto 10px; animation:heartPop 1.2s ease-in-out infinite alternate;
  }
  @keyframes heartPop { from { transform: scale(1); } to { transform: scale(1.08); } }

  .input-row { display:flex; gap:10px; margin-top:16px; align-items:center; justify-content:center; }
  .login-input {
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid #e6e6e6;
    font-size:15px;
    outline:none;
  }
  .login-input:focus { box-shadow: 0 4px 18px rgba(160,160,160,0.08); border-color:var(--coral); }

  .login-btn {
    background:var(--coral);
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    font-size:15px;
  }
  .login-btn:active { transform: translateY(1px); }

  /* ì‘ì€ ë³´ì¡° í…ìŠ¤íŠ¸ */
  .muted { font-size:13px; color:#6b7280; margin-top:10px; }

  /* ëŒ€ì‹œë³´ë“œ: ì´ˆê¹ƒê°’ì€ ìˆ¨ê¹€(ì™„ì „í•œ overlayë¡œ ë¡œê·¸ì¸ê³¼ ê²¹ì¹¨) */
  #dashboard {
    position:fixed;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:18px;
    padding-top:28px;
    overflow:auto;
    background: #fff;
    opacity:0; pointer-events:none;
    transition: opacity .45s ease;
  }
  #dashboard.show { opacity:1; pointer-events:auto; }

  .topbar {
    width:min(1100px,95%);
    display:flex; justify-content:space-between; align-items:center; gap:12px;
  }
  .user-display { font-weight:600; color:var(--navy); }

  .grid {
    width:min(1100px,95%);
    display:flex;
    gap:16px;
    align-items:flex-start;
    justify-content:center;
    flex-wrap:wrap;
    margin-top:6px;
  }

  .panel {
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 8px 24px rgba(39,49,64,0.04);
    border:1px solid rgba(0,0,0,0.04);
    flex:1 1 300px;
    min-width:260px;
    max-width:420px;
  }
  .panel h3 { margin:0 0 8px 0; font-size:16px; color:var(--navy) }
  textarea {
    width:100%; min-height:88px; resize:vertical;
    border:1px solid #e6e6e6; border-radius:8px; padding:10px; font-size:14px;
  }
  .save-btn { margin-top:8px; background:var(--coral); color:#fff; border:none; padding:9px 12px; border-radius:8px; cursor:pointer; font-weight:600; }

  /* ë¡œê·¸ í•­ëª© */
  .log { margin-top:10px; display:flex; flex-direction:column; gap:8px; max-height:320px; overflow:auto; padding-right:6px; }
  .entry { background:#fbfbfb; padding:10px; border-radius:8px; font-size:14px; box-shadow:0 2px 6px rgba(0,0,0,0.03) }
  .meta { font-size:12px; color:#6b7280; margin-top:6px }

  /* í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í–‰ */
  .playlist-wrap { width:min(1100px,95%); margin-bottom:36px; }
  .playlist-controls { display:flex; gap:8px; margin-bottom:12px; }
  .playlist-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr)); gap:12px; }

  /* ë°˜ì‘í˜• ê°œì„  */
  @media(max-width:860px){
    .grid { flex-direction:column; align-items:stretch; padding:12px; }
    .panel { max-width:100% }
    .login-card { width:92%; padding:20px; }
  }
</style>
</head>
<body>

  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div class="screen" id="loginScreen" aria-hidden="false">
    <div class="login-card" role="dialog" aria-label="Login">
      <div class="heart" aria-hidden="true">ğŸ¤</div>
      <div class="brand">Couple Diary</div>

      <div class="input-row" style="width:100%; margin-top:8px;">
        <input id="loginId" class="login-input" placeholder="ID ì…ë ¥ (SM0710 / CY0710)" aria-label="ID ì…ë ¥" />
      </div>

      <div style="margin-top:14px;">
        <button id="loginBtn" class="login-btn" aria-label="ë¡œê·¸ì¸ ë²„íŠ¼">Login</button>
      </div>

      <div class="muted">SM0710 = ê¹€ì†”ìŒ (ğŸ–¤) Â· CY0710 = ìµœìš”ì› (ğŸ’™)</div>
    </div>
  </div>

  <!-- ëŒ€ì‹œë³´ë“œ í™”ë©´ -->
  <main id="dashboard" role="main" aria-hidden="true">
    <div class="topbar">
      <div id="dateDisplay" style="color:#6b7280"></div>
      <div class="user-display" id="userDisplay"></div>
    </div>

    <div class="grid" role="region" aria-label="Main sections">
      <section class="panel" aria-labelledby="todayTitle">
        <h3 id="todayTitle">ğŸ–¤ Today Log</h3>
        <textarea id="todayInput" placeholder="ì˜¤ëŠ˜ì˜ ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="saveToday" class="save-btn">ì €ì¥</button>
        </div>
        <div class="log" id="todayList" aria-live="polite"></div>
      </section>

      <section class="panel" aria-labelledby="photoTitle" id="photoPanel">
        <h3 id="photoTitle">ğŸ“¸ Couple Photo (ë”ë¸”í´ë¦­ ì—…ë¡œë“œ)</h3>
        <div id="photoBox" style="border-radius:10px; overflow:hidden; background:#f6f6f6; min-height:220px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
          <img id="photoImg" src="https://via.placeholder.com/520x360?text=Couple+Photo" alt="couple" style="max-width:100%; height:auto; display:block;" />
        </div>
        <input type="file" id="photoFile" accept="image/*" style="display:none" />
      </section>

      <section class="panel" aria-labelledby="chatTitle">
        <h3 id="chatTitle">ğŸ’™ Chat Log</h3>
        <textarea id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="sendChat" class="save-btn">ë³´ë‚´ê¸°</button>
        </div>
        <div class="log" id="chatList" aria-live="polite"></div>
      </section>
    </div>

    <div class="playlist-wrap">
      <div class="playlist-controls" style="width:min(1100px,95%); margin:0 auto 8px;">
        <input id="musicUrl" placeholder="YouTube ë§í¬ ì…ë ¥" style="flex:1; padding:10px; border-radius:8px; border:1px solid #e7e7e7" />
        <button id="addMusic" class="save-btn">ì¶”ê°€</button>
      </div>
      <div class="playlist-grid" id="playlistGrid" style="width:min(1100px,95%); margin:0 auto 40px;"></div>
    </div>
  </main>

<script>
/* -------------------------
   ë¡œê·¸ì¸ / ëŒ€ì‹œë³´ë“œ ì „í™˜ (í˜ì´ë“œ ì¸)
   - Enter í‚¤ë¡œ ë¡œê·¸ì¸ ë™ì‘
   - ìŠ¤í¬ë¡¤ì´ ìƒê¸°ì§€ ì•Šê²Œ body overflow ê´€ë¦¬
   ------------------------- */

const loginScreen = document.getElementById('loginScreen');
const loginId = document.getElementById('loginId');
const loginBtn = document.getElementById('loginBtn');
const dashboard = document.getElementById('dashboard');
const userDisplay = document.getElementById('userDisplay');
const dateDisplay = document.getElementById('dateDisplay');

function setDate() {
  const d = new Date();
  dateDisplay.textContent = `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
}
setDate();

// ë¡œê·¸ì¸ ì²˜ë¦¬
function performLogin() {
  const id = loginId.value.trim();
  if (!id) { alert('IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); loginId.focus(); return; }
  if (id !== 'SM0710' && id !== 'CY0710') { alert('ë“±ë¡ë˜ì§€ ì•Šì€ IDì…ë‹ˆë‹¤. SM0710 ë˜ëŠ” CY0710 ì…ë ¥í•´ ì£¼ì„¸ìš”.'); loginId.focus(); return; }

  // í˜„ì¬ ì‚¬ìš©ì ì €ì¥
  const user = id === 'SM0710' ? { id, name:'ê¹€ì†”ìŒ', heart:'ğŸ–¤' } : { id, name:'ìµœìš”ì›', heart:'ğŸ’™' };
  localStorage.setItem('cd_current_user', JSON.stringify(user));

  // í™”ë©´ ì „í™˜ (í˜ì´ë“œ ì¸)
  loginScreen.style.display = 'none';      // ì™„ì „ ìˆ¨ê¹€ìœ¼ë¡œ ê³µê°„ ì œê±°
  dashboard.classList.add('fade-in');
  dashboard.classList.add('show');         // cssë¡œ opacity ì œì–´
  dashboard.style.opacity = 1;
  dashboard.setAttribute('aria-hidden','false');

  // í‘œì‹œ ì—…ë°ì´íŠ¸
  userDisplay.textContent = `${user.name} ${user.heart}`;

  // ë°ì´í„° ë¡œë“œ
  loadAllLogs();
  loadPlaylist();
  loadPhoto();

  // lock page scroll (optional in this UI we keep body overflow auto for dashboard)
  document.body.style.overflow = 'auto';
}

// Enter í‚¤ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥
loginId.addEventListener('keypress', (e) => { if (e.key === 'Enter') performLogin(); });
loginBtn.addEventListener('click', performLogin);

// ë¡œê·¸ì•„ì›ƒ (ê°„ë‹¨)
userDisplay.addEventListener('click', () => {
  if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ì–´ìš”?')) return;
  localStorage.removeItem('cd_current_user');
  dashboard.classList.remove('show');
  dashboard.style.opacity = 0;
  dashboard.setAttribute('aria-hidden','true');
  // ë¡œê·¸ì¸ í™”ë©´ ë‹¤ì‹œ ë³´ì´ê²Œ
  loginScreen.style.display = 'flex';
  loginId.value = '';
  loginId.focus();
  document.body.style.overflow = 'hidden';
});


/* -------------------------
   ì €ì¥/ë¡œì»¬ ë¡œì§ (íˆ¬ë°ì´/ì±„íŒ…/í”Œë ˆì´ë¦¬ìŠ¤íŠ¸)
   - ê¸°ì¡´ ë°ì´í„° ìœ ì§€: localStorage ì‚¬ìš©
   - ì‹œê°„ í‘œê¸°ëŠ” YYYY.MM.DD HH:MM (ì‹œ:ë¶„)
   ------------------------- */

function timeNow() {
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,'0');
  const mm = String(d.getMinutes()).padStart(2,'0');
  return `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')} ${hh}:${mm}`;
}

/* Today */
const todayInput = document.getElementById('todayInput');
const saveToday = document.getElementById('saveToday');
const todayList = document.getElementById('todayList');

saveToday.addEventListener('click', () => {
  const user = JSON.parse(localStorage.getItem('cd_current_user') || '{}');
  if (!user.id) { alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.'); return; }
  const txt = todayInput.value.trim();
  if (!txt) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
  const arr = JSON.parse(localStorage.getItem('cd_today') || '[]');
  arr.push({ user: user.name, id: user.id, text: txt, time: timeNow() });
  localStorage.setItem('cd_today', JSON.stringify(arr));
  todayInput.value = '';
  renderToday();
});
function renderToday() {
  const arr = JSON.parse(localStorage.getItem('cd_today') || '[]');
  todayList.innerHTML = '';
  arr.slice().reverse().forEach(it => {
    const el = document.createElement('div');
    el.className = 'entry';
    el.innerHTML = `<div><strong>${it.user}</strong> <span class="meta">${it.time}</span></div><div style="margin-top:6px">${escapeHtml(it.text)}</div>`;
    todayList.appendChild(el);
  });
}

/* Chat */
const chatInput = document.getElementById('chatInput');
const sendChat = document.getElementById('sendChat');
const chatList = document.getElementById('chatList');

sendChat.addEventListener('click', () => {
  const user = JSON.parse(localStorage.getItem('cd_current_user') || '{}');
  if (!user.id) { alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.'); return; }
  const txt = chatInput.value.trim();
  if (!txt) return alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  const arr = JSON.parse(localStorage.getItem('cd_chat') || '[]');
  arr.push({ user: user.name, id: user.id, text: txt, time: timeNow() });
  localStorage.setItem('cd_chat', JSON.stringify(arr));
  chatInput.value = '';
  renderChat();
});
function renderChat() {
  const arr = JSON.parse(localStorage.getItem('cd_chat') || '[]');
  chatList.innerHTML = '';
  arr.slice().reverse().forEach(it => {
    const el = document.createElement('div');
    el.className = 'entry';
    el.style.textAlign = 'right';
    el.innerHTML = `<div><strong>${it.user}</strong> <span class="meta">${it.time}</span></div><div style="margin-top:6px">${escapeHtml(it.text)}</div>`;
    chatList.appendChild(el);
  });
}

/* Playlist */
const addMusic = document.getElementById('addMusic');
const musicUrl = document.getElementById('musicUrl');
const playlistGrid = document.getElementById('playlistGrid');

addMusic.addEventListener('click', () => {
  const url = musicUrl.value.trim();
  const user = JSON.parse(localStorage.getItem('cd_current_user') || '{}');
  if (!user.id) { alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.'); return; }
  if (!url) return alert('ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  const arr = JSON.parse(localStorage.getItem('cd_playlist') || '[]');
  arr.push({ url, by: user.name, time: timeNow() });
  localStorage.setItem('cd_playlist', JSON.stringify(arr));
  musicUrl.value = '';
  renderPlaylist();
});

function renderPlaylist() {
  const arr = JSON.parse(localStorage.getItem('cd_playlist') || '[]');
  playlistGrid.innerHTML = '';
  arr.slice().reverse().forEach(it => {
    const vid = extractYouTubeId(it.url);
    const div = document.createElement('div');
    div.className = 'panel';
    div.style.padding = '8px';
    div.innerHTML = vid
      ? `<div style="position:relative;padding-top:56.25%"><iframe src="https://www.youtube.com/embed/${vid}" style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:8px" allowfullscreen></iframe></div><div class="meta" style="margin-top:8px">by ${escapeHtml(it.by)} â€¢ ${escapeHtml(it.time)}</div>`
      : `<div class="meta">ìœ íš¨í•œ YouTube ë§í¬ê°€ ì•„ë‹™ë‹ˆë‹¤.</div>`;
    playlistGrid.appendChild(div);
  });
}

/* Photo (ë”ë¸”í´ë¦­ ì—…ë¡œë“œ â€” uses localStorage URL) */
const photoBox = document.getElementById('photoBox');
const photoImg = document.getElementById('photoImg');
const photoFile = document.getElementById('photoFile');

photoBox.addEventListener('dblclick', () => {
  const user = JSON.parse(localStorage.getItem('cd_current_user') || '{}');
  if (!user.id) { alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.'); return; }
  photoFile.click();
});
photoFile.addEventListener('change', async (e) => {
  const f = e.target.files[0];
  if (!f) return;
  // ë¸Œë¼ìš°ì €ì—ì„œ base64ë¡œ ì½ì–´ì„œ localStorageì— ì €ì¥ (ì‘ì€ ì´ë¯¸ì§€ë§Œ ê¶Œì¥)
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = reader.result;
      // ì €ì¥
      localStorage.setItem('cd_photo', data);
      photoImg.src = data;
    } catch (err) {
      alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };
  reader.readAsDataURL(f);
});

/* ìœ í‹¸: ë¡œë“œ ëª¨ë“  ë¡œê·¸/í”Œë ˆì´ë¦¬ìŠ¤íŠ¸/ì‚¬ì§„ */
function loadAllLogs() { renderToday(); renderChat(); renderPlaylist(); }
function loadPlaylist() { renderPlaylist(); }
function loadPhoto() { const p = localStorage.getItem('cd_photo'); if (p) photoImg.src = p; }

/* small helpers */
function extractYouTubeId(url) {
  const m = url.match(/(?:v=|\/)([0-9A-Za-z_-]{6,11})(?:[&?]|$)/);
  return m ? m[1] : null;
}
function escapeHtml(s) {
  return String(s || '').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

/* ì´ˆê¸° ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ â€” ë§Œì•½ ì „ì— ë¡œê·¸ì¸ ì •ë³´ ë‚¨ì•„ìˆìœ¼ë©´ ë°”ë¡œ ì§„ì… */
(function init() {
  const user = JSON.parse(localStorage.getItem('cd_current_user') || 'null');
  if (user && (user.id === 'SM0710' || user.id === 'CY0710')) {
    loginId.value = user.id;
    performAutoLogin(user);
  } else {
    // ê¸°ë³¸: ë¡œê·¸ì¸ í™”ë©´ì—ì„œ body scroll ì ê¸ˆ
    document.body.style.overflow = 'hidden';
    loginId.focus();
  }

  // helper: auto login
  function performAutoLogin(user) {
    loginScreen.style.display = 'none';
    dashboard.classList.add('show');
    dashboard.style.opacity = 1;
    dashboard.setAttribute('aria-hidden','false');
    userDisplay.textContent = `${user.name} ${user.heart}`;
    document.body.style.overflow = 'auto';
    loadAllLogs();
    loadPhoto();
  }
})();
</script>

</body>
</html>
