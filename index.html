<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Couple Diary</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Pretendard", sans-serif; }
    body {
      background-color: #fffaf8;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      transition: background-color 0.5s ease;
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: white;
      padding: 2rem 3rem;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.5s ease;
    }

    input {
      margin: 10px 0;
      padding: 0.7rem 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 220px;
    }

    button {
      background-color: #f5a9a9;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover { background-color: #f28b8b; }

    #dashboard {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      height: 100vh;
      overflow-y: auto;
      background-color: #fffaf8;
      padding: 2rem;
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
      width: 100%;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 1.2rem;
      width: 90%;
      max-width: 600px;
      margin: 0.8rem auto;
      transition: transform 0.3s ease;
    }

    .card:hover { transform: translateY(-3px); }

    .playlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }

    .playlist-item {
      background: #fff;
      border-radius: 12px;
      padding: 0.8rem;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

  <div id="login" class="login-container fade-in">
    <h2>Couple Diary</h2>
    <input type="text" id="userId" placeholder="ID ÏûÖÎ†•" />
    <button onclick="login()">Login</button>
  </div>

  <div id="dashboard" class="fade-in">
    <div class="top-bar">
      <span id="userInfo"></span>
      <button onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
    </div>

    <div class="card">
      <h3>Ïò§ÎäòÏùò Í∏∞Î°ù</h3>
      <div id="todayLogs"></div>
      <textarea id="todayInput" placeholder="Ïò§ÎäòÏùò Ïù¥ÏïºÍ∏∞Î•º Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî"></textarea>
      <button onclick="saveToday()">Ï†ÄÏû•</button>
    </div>

    <div class="card">
      <h3>Ï±ÑÌåÖ Î°úÍ∑∏</h3>
      <div id="chatLogs"></div>
      <input id="chatInput" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
      <button onclick="sendChat()">Î≥¥ÎÇ¥Í∏∞</button>
    </div>

    <div class="card">
      <h3>ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ üéß</h3>
      <div class="playlist-grid" id="playlist"></div>
      <input id="musicLink" placeholder="ÎÖ∏Îûò ÎßÅÌÅ¨ ÏûÖÎ†•" />
      <button onclick="addMusic()">Ï∂îÍ∞Ä</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAlUnuq-CT_CKspBltCUCZbDtk8KD5wrSI",
      authDomain: "couple-diary-42d49.firebaseapp.com",
      projectId: "couple-diary-42d49",
      storageBucket: "couple-diary-42d49.appspot.com",
      messagingSenderId: "612014642451",
      appId: "1:612014642451:web:d3721b7cc6cf8d655c2e0e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser = null;

    function login() {
      const id = document.getElementById("userId").value.trim();
      if (!id) return alert("IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      currentUser = id;
      localStorage.setItem("userId", id);
      document.getElementById("login").style.display = "none";
      loadDashboard();
    }

    function logout() {
      localStorage.removeItem("userId");
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("login").style.display = "flex";
    }

    async function loadDashboard() {
      const id = localStorage.getItem("userId");
      if (!id) return;
      currentUser = id;

      document.getElementById("dashboard").style.display = "flex";
      document.getElementById("userInfo").innerHTML =
        `${id} ${id === "ÍπÄÏÜîÏùå" ? "üñ§" : "üíô"}`;

      // üî∏ Ìà¨Îç∞Ïù¥ Î°úÍ∑∏ Î∂àÎü¨Ïò§Í∏∞
      firebase.firestore().collection("todayLog")
        .orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const logs = snapshot.docs.map(doc => {
            const d = doc.data();
            return `<p>${d.text} <small>(${d.date})</small></p>`;
          }).join("");
          document.getElementById("todayLogs").innerHTML = logs;
        });

      // üî∏ Ï±ÑÌåÖ Î°úÍ∑∏ Î∂àÎü¨Ïò§Í∏∞
      firebase.firestore().collection("chatLog")
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          const chats = snapshot.docs.map(doc => {
            const d = doc.data();
            return `<p><b>${d.user}</b>: ${d.text} <small>${d.date}</small></p>`;
          }).join("");
          document.getElementById("chatLogs").innerHTML = chats;
        });

      // üî∏ ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ Î∂àÎü¨Ïò§Í∏∞
      firebase.firestore().collection("musicList")
        .orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const items = snapshot.docs.map(doc => {
            const d = doc.data();
            return `<div class="playlist-item"><a href="${d.link}" target="_blank">üéµ ${d.link}</a></div>`;
          }).join("");
          document.getElementById("playlist").innerHTML = items;
        });
    }

    async function saveToday() {
      const text = document.getElementById("todayInput").value.trim();
      if (!text) return;
      await db.collection("todayLog").add({
        text,
        user: currentUser,
        date: new Date().toLocaleString(),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("todayInput").value = "";
    }

    async function sendChat() {
      const text = document.getElementById("chatInput").value.trim();
      if (!text) return;
      await db.collection("chatLog").add({
        text,
        user: currentUser,
        date: new Date().toLocaleString(),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("chatInput").value = "";
    }

    async function addMusic() {
      const link = document.getElementById("musicLink").value.trim();
      if (!link) return;
      await db.collection("musicList").add({
        link,
        user: currentUser,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById("musicLink").value = "";
    }

    // ÏûêÎèô Î°úÍ∑∏Ïù∏ Ïú†ÏßÄ
    window.onload = () => {
      const id = localStorage.getItem("userId");
      if (id) {
        document.getElementById("login").style.display = "none";
        loadDashboard();
      }
    };
  </script>
</body>
</html>
