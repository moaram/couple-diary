    // âš™ï¸ DOM
    const loginSection = document.getElementById("login-section");
    const dashboard = document.getElementById("dashboard");
    const loginBtn = document.getElementById("login-btn");
    const loginId = document.getElementById("login-id");
    const userDisplay = document.getElementById("userDisplay");
    const logoutBtn = document.getElementById("logoutBtn");
    const alertBox = document.getElementById("alertBox");

    let currentUser = null;

    // âœ¨ ì•Œë¦¼ í•¨ìˆ˜
    function showAlert(msg) {
      alertBox.textContent = msg;
      alertBox.style.display = "block";
      setTimeout(() => (alertBox.style.display = "none"), 2000);
    }

    // ğŸ©µ ë¡œê·¸ì¸
    loginBtn.addEventListener("click", () => {
      const id = loginId.value.trim();
      if (id === "SM0710" || id === "CY0710") {
        currentUser = id === "SM0710" ? "ê¹€ì†”ìŒ" : "ìµœìš”ì›";
        userDisplay.textContent = `${currentUser} ${currentUser === "ê¹€ì†”ìŒ" ? "ğŸ–¤" : "ğŸ’™"}`;
        loginSection.style.display = "none";
        dashboard.style.display = "flex";
        loadAll();
      } else showAlert("ì•„ì´ë””ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!");
    });

    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      dashboard.style.display = "none";
      loginSection.style.display = "flex";
      loginId.value = "";
    });

    // ğŸ“ Today Log
    const todayText = document.getElementById("today-text");
    const todaySave = document.getElementById("today-save");
    const todayList = document.getElementById("today-list");

    todaySave.addEventListener("click", async () => {
      const text = todayText.value.trim();
      if (!text || !currentUser) return;
      await addDoc(collection(db, "todayLogs"), {
        text,
        updateBy: currentUser,
        timestamp: serverTimestamp(),
      });
      todayText.value = "";
      showAlert("âœ¨ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    });

    async function loadToday() {
      const q = query(collection(db, "todayLogs"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        todayList.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const div = document.createElement("div");
          div.className = "p-2 bg-[#e8edf2] rounded-xl shadow-inner flex justify-between items-start fadeIn";
          const date = d.timestamp?.toDate ? new Date(d.timestamp.toDate()) : new Date();
          const dateStr = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}ì‹œ${date.getMinutes()}ë¶„`;
          div.innerHTML = `
            <div>
              <strong>${d.updateBy || "ìµëª…"}</strong>
              <p>${d.text}</p>
              <small>${dateStr}</small>
            </div>
            ${d.updateBy === currentUser ? `
              <div class="flex flex-col text-xs ml-2">
                <button class="edit-btn">ìˆ˜ì •</button>
                <button class="del-btn">ì‚­ì œ</button>
              </div>` : ""}
          `;
          if (d.updateBy === currentUser) {
            div.querySelector(".edit-btn").onclick = async () => {
              const newText = prompt("ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:", d.text);
              if (newText) {
                await updateDoc(doc(db, "todayLogs", docSnap.id), { text: newText });
                showAlert("âœ¨ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
              }
            };
            div.querySelector(".del-btn").onclick = async () => {
              await deleteDoc(doc(db, "todayLogs", docSnap.id));
              showAlert("ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
            };
          }
          todayList.appendChild(div);
        });
      });
    }

    // ğŸ’¬ Chat
    const chatBox = document.getElementById("chat-box");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    sendBtn.addEventListener("click", sendMessage);
    chatInput.addEventListener("keypress", (e) => e.key === "Enter" && sendMessage());

    async function sendMessage() {
      const msg = chatInput.value.trim();
      if (!msg || !currentUser) return;
      await addDoc(collection(db, "chat"), {
        message: msg,
        name: currentUser,
        timestamp: serverTimestamp(),
      });
      chatInput.value = "";
    }

    async function loadChat() {
      const q = query(collection(db, "chat"), orderBy("timestamp", "asc"));
      onSnapshot(q, (snap) => {
        chatBox.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const date = d.timestamp?.toDate ? new Date(d.timestamp.toDate()) : new Date();
          const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${date.getMinutes()}`;
          const div = document.createElement("div");
          div.className = `chat-message ${d.name === currentUser ? "chat-me self-end" : "chat-other self-start"}`;
          div.innerHTML = `
            <p>${d.message}</p>
            <small>${d.name} â€¢ ${dateStr}</small>
            ${d.name === currentUser ? `
              <div class="flex justify-end gap-2 text-xs mt-1">
                <button class="edit-btn">ìˆ˜ì •</button>
                <button class="del-btn">ì‚­ì œ</button>
              </div>` : ""}
          `;
          if (d.name === currentUser) {
            div.querySelector(".edit-btn").onclick = async () => {
              const newMsg = prompt("ìˆ˜ì •í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", d.message);
              if (newMsg) {
                await updateDoc(doc(db, "chat", docSnap.id), { message: newMsg });
                showAlert("âœ¨ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
              }
            };
            div.querySelector(".del-btn").onclick = async () => {
              await deleteDoc(doc(db, "chat", docSnap.id));
              showAlert("ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
            };
          }
          chatBox.appendChild(div);
          chatBox.scrollTop = chatBox.scrollHeight;
        });
      });
    }

    // ğŸ“¸ Photo Upload
    const photoUpload = document.getElementById("photo-upload");
    const photoDisplay = document.getElementById("photo-display");

    photoUpload.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const storageRef = ref(storage, `photos/${Date.now()}-${file.name}`);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      await addDoc(collection(db, "photo"), {
        url,
        name: currentUser,
        timestamp: serverTimestamp(),
      });
      showAlert("ğŸ“¸ ì‚¬ì§„ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!");
    });

    async function loadPhoto() {
      const q = query(collection(db, "photo"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        if (!snap.empty) {
          const latest = snap.docs[0].data();
          photoDisplay.src = latest.url;
        }
      });
    }

    // ğŸµ Playlist
    const musicLink = document.getElementById("music-link");
    const musicAdd = document.getElementById("music-add");
    const musicList = document.getElementById("music-list");

    musicAdd.addEventListener("click", async () => {
      const url = musicLink.value.trim();
      if (!url) return;
      await addDoc(collection(db, "playlist"), {
        url,
        addedBy: currentUser,
        timestamp: serverTimestamp(),
      });
      musicLink.value = "";
      showAlert("ğŸµ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    });

    async function loadMusic() {
      const q = query(collection(db, "playlist"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        musicList.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const div = document.createElement("div");
          div.className = "playlist-item";
          div.innerHTML = `
            <iframe width="100%" height="150" src="${d.url.replace("watch?v=", "embed/")}" allowfullscreen></iframe>
            <small class="block mt-1 text-xs text-gray-500">by ${d.addedBy || "ìµëª…"}</small>`;
          musicList.appendChild(div);
        });
      });
    }

    // ğŸ“¦ ì „ì²´ ë¡œë“œ
    function loadAll() {
      loadToday();
      loadChat();
      loadPhoto();
      loadMusic();
    }
  </script>
</body>
</html>
