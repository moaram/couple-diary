    // ⚙️ DOM
    const loginSection = document.getElementById("login-section");
    const dashboard = document.getElementById("dashboard");
    const loginBtn = document.getElementById("login-btn");
    const loginId = document.getElementById("login-id");
    const userDisplay = document.getElementById("userDisplay");
    const logoutBtn = document.getElementById("logoutBtn");
    const alertBox = document.getElementById("alertBox");

    let currentUser = null;

    // ✨ 알림 함수
    function showAlert(msg) {
      alertBox.textContent = msg;
      alertBox.style.display = "block";
      setTimeout(() => (alertBox.style.display = "none"), 2000);
    }

    // 🩵 로그인
    loginBtn.addEventListener("click", () => {
      const id = loginId.value.trim();
      if (id === "SM0710" || id === "CY0710") {
        currentUser = id === "SM0710" ? "김솔음" : "최요원";
        userDisplay.textContent = `${currentUser} ${currentUser === "김솔음" ? "🖤" : "💙"}`;
        loginSection.style.display = "none";
        dashboard.style.display = "flex";
        loadAll();
      } else showAlert("아이디가 올바르지 않습니다!");
    });

    logoutBtn.addEventListener("click", () => {
      currentUser = null;
      dashboard.style.display = "none";
      loginSection.style.display = "flex";
      loginId.value = "";
    });

    // 📝 Today Log
    const todayText = document.getElementById("today-text");
    const todaySave = document.getElementById("today-save");
    const todayList = document.getElementById("today-list");

    todaySave.addEventListener("click", async () => {
      const text = todayText.value.trim();
      if (!text || !currentUser) return;
      await addDoc(collection(db, "todayLogs"), {
        text,
        updateBy: currentUser,
        timestamp: serverTimestamp(),
      });
      todayText.value = "";
      showAlert("✨ 저장되었습니다!");
    });

    async function loadToday() {
      const q = query(collection(db, "todayLogs"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        todayList.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const div = document.createElement("div");
          div.className = "p-2 bg-[#e8edf2] rounded-xl shadow-inner flex justify-between items-start fadeIn";
          const date = d.timestamp?.toDate ? new Date(d.timestamp.toDate()) : new Date();
          const dateStr = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}시${date.getMinutes()}분`;
          div.innerHTML = `
            <div>
              <strong>${d.updateBy || "익명"}</strong>
              <p>${d.text}</p>
              <small>${dateStr}</small>
            </div>
            ${d.updateBy === currentUser ? `
              <div class="flex flex-col text-xs ml-2">
                <button class="edit-btn">수정</button>
                <button class="del-btn">삭제</button>
              </div>` : ""}
          `;
          if (d.updateBy === currentUser) {
            div.querySelector(".edit-btn").onclick = async () => {
              const newText = prompt("수정할 내용을 입력하세요:", d.text);
              if (newText) {
                await updateDoc(doc(db, "todayLogs", docSnap.id), { text: newText });
                showAlert("✨ 수정되었습니다!");
              }
            };
            div.querySelector(".del-btn").onclick = async () => {
              await deleteDoc(doc(db, "todayLogs", docSnap.id));
              showAlert("🗑️ 삭제되었습니다!");
            };
          }
          todayList.appendChild(div);
        });
      });
    }

    // 💬 Chat
    const chatBox = document.getElementById("chat-box");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    sendBtn.addEventListener("click", sendMessage);
    chatInput.addEventListener("keypress", (e) => e.key === "Enter" && sendMessage());

    async function sendMessage() {
      const msg = chatInput.value.trim();
      if (!msg || !currentUser) return;
      await addDoc(collection(db, "chat"), {
        message: msg,
        name: currentUser,
        timestamp: serverTimestamp(),
      });
      chatInput.value = "";
    }

    async function loadChat() {
      const q = query(collection(db, "chat"), orderBy("timestamp", "asc"));
      onSnapshot(q, (snap) => {
        chatBox.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const date = d.timestamp?.toDate ? new Date(d.timestamp.toDate()) : new Date();
          const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${date.getMinutes()}`;
          const div = document.createElement("div");
          div.className = `chat-message ${d.name === currentUser ? "chat-me self-end" : "chat-other self-start"}`;
          div.innerHTML = `
            <p>${d.message}</p>
            <small>${d.name} • ${dateStr}</small>
            ${d.name === currentUser ? `
              <div class="flex justify-end gap-2 text-xs mt-1">
                <button class="edit-btn">수정</button>
                <button class="del-btn">삭제</button>
              </div>` : ""}
          `;
          if (d.name === currentUser) {
            div.querySelector(".edit-btn").onclick = async () => {
              const newMsg = prompt("수정할 메시지를 입력하세요:", d.message);
              if (newMsg) {
                await updateDoc(doc(db, "chat", docSnap.id), { message: newMsg });
                showAlert("✨ 수정되었습니다!");
              }
            };
            div.querySelector(".del-btn").onclick = async () => {
              await deleteDoc(doc(db, "chat", docSnap.id));
              showAlert("🗑️ 삭제되었습니다!");
            };
          }
          chatBox.appendChild(div);
          chatBox.scrollTop = chatBox.scrollHeight;
        });
      });
    }

    // 📸 Photo Upload
    const photoUpload = document.getElementById("photo-upload");
    const photoDisplay = document.getElementById("photo-display");

    photoUpload.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const storageRef = ref(storage, `photos/${Date.now()}-${file.name}`);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      await addDoc(collection(db, "photo"), {
        url,
        name: currentUser,
        timestamp: serverTimestamp(),
      });
      showAlert("📸 사진이 업로드되었습니다!");
    });

    async function loadPhoto() {
      const q = query(collection(db, "photo"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        if (!snap.empty) {
          const latest = snap.docs[0].data();
          photoDisplay.src = latest.url;
        }
      });
    }

    // 🎵 Playlist
    const musicLink = document.getElementById("music-link");
    const musicAdd = document.getElementById("music-add");
    const musicList = document.getElementById("music-list");

    musicAdd.addEventListener("click", async () => {
      const url = musicLink.value.trim();
      if (!url) return;
      await addDoc(collection(db, "playlist"), {
        url,
        addedBy: currentUser,
        timestamp: serverTimestamp(),
      });
      musicLink.value = "";
      showAlert("🎵 플레이리스트에 추가되었습니다!");
    });

    async function loadMusic() {
      const q = query(collection(db, "playlist"), orderBy("timestamp", "desc"));
      onSnapshot(q, (snap) => {
        musicList.innerHTML = "";
        snap.forEach((docSnap) => {
          const d = docSnap.data();
          const div = document.createElement("div");
          div.className = "playlist-item";
          div.innerHTML = `
            <iframe width="100%" height="150" src="${d.url.replace("watch?v=", "embed/")}" allowfullscreen></iframe>
            <small class="block mt-1 text-xs text-gray-500">by ${d.addedBy || "익명"}</small>`;
          musicList.appendChild(div);
        });
      });
    }

    // 📦 전체 로드
    function loadAll() {
      loadToday();
      loadChat();
      loadPhoto();
      loadMusic();
    }
  </script>
</body>
</html>
