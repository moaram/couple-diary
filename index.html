<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í¬ë„í•˜ê³ </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Noto Serif KR', serif; scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-white text-black flex flex-col items-center px-5 py-10">

  <!-- ë¡œê·¸ì¸ í™”ë©´ -->
  <div id="login-screen" class="w-full max-w-xs text-center">
    <h1 class="text-3xl font-bold mb-5">ğŸ–¤ Login</h1>
    <input id="login-id" type="text" placeholder="ì•„ì´ë”” ì…ë ¥ (SM0710)"
      class="border w-full px-3 py-2 rounded mb-3 focus:outline-none focus:ring-1 focus:ring-gray-400" />
    <button id="login-btn" class="w-full bg-black text-white py-2 rounded hover:bg-gray-800">ë¡œê·¸ì¸</button>
    <p class="text-gray-500 text-sm mt-3">Â© 2025 Couple Diary</p>
  </div>

  <!-- ë©”ì¸ í™”ë©´ -->
  <div id="main-screen" class="hidden w-full max-w-3xl space-y-10">

    <!-- Header -->
    <header class="text-center mb-10">
      <div id="user-heart" class="text-4xl mb-2">ğŸ–¤</div>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">Couple Diary Dashboard</h1>
      <p class="text-gray-600">í¬ë„ì•¼ ì‚¬ë‘í•´</p>
      <button id="logout-btn" class="mt-3 text-sm text-gray-500 hover:underline">ë¡œê·¸ì•„ì›ƒ</button>
    </header>

    <!-- Todayâ€™s Page -->
    <section class="border-t border-gray-300 pt-6">
      <h2 class="text-2xl font-semibold mb-2">ğŸ“… Todayâ€™s Page</h2>
      <p class="text-gray-700 mb-4">ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê°„ë‹¨íˆ ê¸°ë¡í•´ìš”.</p>
      <input type="date" id="today-date" class="border px-3 py-2 w-full rounded focus:outline-none focus:ring-1 focus:ring-gray-400" />
      <textarea id="today-text" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì ì–´ì£¼ì„¸ìš”..." class="mt-3 w-full border px-3 py-2 rounded focus:outline-none focus:ring-1 focus:ring-gray-400"></textarea>
      <button id="save-today" class="mt-2 bg-black text-white px-4 py-2 rounded hover:bg-gray-800">ì €ì¥</button>

      <div id="today-list" class="mt-5 bg-gray-50 p-3 rounded text-sm"></div>
    </section>

    <!-- Our Chat Log -->
    <section id="chat-section" class="border-t border-gray-300 pt-6">
      <h2 class="text-2xl font-semibold mb-2">ğŸ’¬ Our Chat Log</h2>
      <p class="text-gray-700 mb-4">ì„œë¡œ ë‚˜ëˆˆ ëŒ€í™”ë¥¼ ê¸°ë¡í•´ìš”.</p>

      <div id="chat-box" class="bg-gray-100 p-4 rounded text-sm font-mono leading-relaxed h-64 overflow-y-auto flex flex-col-reverse">
        <p class="text-gray-500 text-center">ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ’¬</p>
      </div>

      <div class="mt-4 flex flex-col sm:flex-row gap-2">
        <input id="message-input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
          class="border flex-[3] px-3 py-2 rounded focus:outline-none focus:ring-1 focus:ring-gray-400" />
        <button id="send-btn" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800">í™•ì¸</button>
      </div>
    </section>

    <!-- Anniversary -->
    <section class="border-t border-gray-300 pt-6">
      <h2 class="text-2xl font-semibold mb-2">ğŸ’• Anniversary</h2>
      <table class="w-full text-left border-collapse">
        <thead class="border-b border-gray-300">
          <tr><th class="py-2">ì´ë²¤íŠ¸</th><th class="py-2">ë‚ ì§œ</th><th class="py-2">ë‚¨ì€ ê¸°ê°„</th></tr>
        </thead>
        <tbody id="anniversary-table"></tbody>
      </table>
    </section>

    <!-- Quotes -->
    <section class="border-t border-gray-300 pt-6">
      <h2 class="text-2xl font-semibold mb-2">âœ‰ï¸ Quotes & Letters</h2>
      <div class="space-y-3 text-gray-700">
        <p>ğŸ–¤ â€œë§ì´ ì¢‹ì•„í•´. ì‚¬ë‘í•´.â€</p>
        <p>ğŸ•¯ï¸ â€œì‚¬ì†Œí•œ ìˆœê°„ë“¤ì´ ì œì¼ ì†Œì¤‘í•´.â€</p>
        <p>ğŸŒ™ â€œê°™ì´ ìˆëŠ” ì§€ê¸ˆì´ ì œì¼ ì¢‹ì•„.â€</p>
      </div>
    </section>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBw9CXG7BMyCQ3qMWFaXPfi_gS_HIiXIOA",
      authDomain: "couple-diary-42d49.firebaseapp.com",
      projectId: "couple-diary-42d49",
      storageBucket: "couple-diary-42d49.firebasestorage.app",
      messagingSenderId: "162533479109",
      appId: "1:162533479109:web:a67f8d213bddafc66fd6ac",
      measurementId: "G-2N8R9H692D"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- ë¡œê·¸ì¸ ---
    const loginScreen = document.getElementById("login-screen");
    const mainScreen = document.getElementById("main-screen");
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const userHeart = document.getElementById("user-heart");
    let currentUser = null;

    loginBtn.addEventListener("click", login);
    document.getElementById("login-id").addEventListener("keydown", e => {
      if (e.key === "Enter") login();
    });

    function login() {
      const id = document.getElementById("login-id").value.trim();
      if (id === "SM0710") {
        currentUser = { id, name: "ê¹€ì†”ìŒ", heart: "ğŸ–¤" };
      } else if (id === "CY0710") {
        currentUser = { id, name: "ìµœìš”ì›", heart: "ğŸ’™", master: true };
      } else {
        alert("ì•„ì´ë””ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤ ğŸ¤");
        return;
      }
      loginScreen.classList.add("hidden");
      mainScreen.classList.remove("hidden");
      userHeart.textContent = currentUser.heart;
      loadChat();
      loadToday();
      loadAnniversary();
    }

    logoutBtn.addEventListener("click", () => location.reload());

    // --- ëŒ€í™” ê¸°ëŠ¥ ---
    const sendBtn = document.getElementById("send-btn");
    const chatBox = document.getElementById("chat-box");
    const messageInput = document.getElementById("message-input");

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

    function sendMessage() {
      const msg = messageInput.value.trim();
      if (!msg || !currentUser) return;
      db.collection("chats").add({
        name: currentUser.name,
        heart: currentUser.heart,
        message: msg,
        time: Date.now()
      });
      messageInput.value = "";
    }

    function loadChat() {
      db.collection("chats").orderBy("time", "desc").onSnapshot(snapshot => {
        chatBox.innerHTML = "";
        snapshot.forEach(doc => {
          const c = doc.data();
          const p = document.createElement("p");
          p.className = "my-1 flex justify-between";
          p.innerHTML = `${c.heart} <strong>${c.name}</strong>: ${c.message}`;
          if (currentUser.master) {
            const del = document.createElement("button");
            del.textContent = "âŒ";
            del.className = "text-xs ml-2 text-red-400 hover:text-red-600";
            del.onclick = () => db.collection("chats").doc(doc.id).delete();
            p.appendChild(del);
          }
          chatBox.appendChild(p);
        });
      });
    }

    // --- íˆ¬ë°ì´ ---
    const saveToday = document.getElementById("save-today");
    saveToday.addEventListener("click", saveTodayNote);

    async function saveTodayNote() {
      const date = document.getElementById("today-date").value;
      const text = document.getElementById("today-text").value.trim();
      if (!date || !text) return alert("ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ’•");
      await db.collection("today").doc(date).set({
        user: currentUser.name,
        text,
        time: Date.now()
      });
      document.getElementById("today-text").value = "";
    }

    function loadToday() {
      db.collection("today").orderBy("time", "desc").onSnapshot(snapshot => {
        const list = document.getElementById("today-list");
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const d = doc.data();
          const item = document.createElement("div");
          item.className = "p-2 border-b text-gray-700 flex justify-between";
          item.innerHTML = `<div><strong>${d.user}</strong> (${doc.id})<br>${d.text}</div>`;
          if (currentUser.master) {
            const del = document.createElement("button");
            del.textContent = "âŒ";
            del.className = "text-xs text-red-400 hover:text-red-600";
            del.onclick = () => db.collection("today").doc(doc.id).delete();
            item.appendChild(del);
          }
          list.appendChild(item);
        });
      });
    }

    // --- ê¸°ë…ì¼ ---
    function loadAnniversary() {
      const startDate = new Date("2025-07-10");
      const today = new Date();
      const diffDays = Math.floor((today - startDate) / (1000 * 60 * 60 * 24)) + 1;
      const events = [
        { title: "ì‚¬ê·„ ë‚ ", date: startDate },
        { title: "100ì¼", date: new Date(startDate.getTime() + 99 * 24 * 60 * 60 * 1000) },
        { title: "1ì£¼ë…„", date: new Date(startDate.getFullYear() + 1, startDate.getMonth(), startDate.getDate()) }
      ];
      const tbody = document.getElementById("anniversary-table");
      tbody.innerHTML = "";
      events.forEach(event => {
        const diff = Math.ceil((event.date - today) / (1000 * 60 * 60 * 24));
        const remain = diff >= 0 ? `${diff}ì¼ ë‚¨ìŒ` : `${Math.abs(diff)}ì¼ ì§€ë‚¨`;
        const tr = document.createElement("tr");
        tr.className = "border-b border-gray-200";
        tr.innerHTML = `
          <td class="py-2">${event.title}</td>
          <td>${event.date.getFullYear()}.${String(event.date.getMonth() + 1).padStart(2, "0")}.${String(event.date.getDate()).padStart(2, "0")}</td>
          <td>${remain}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>



